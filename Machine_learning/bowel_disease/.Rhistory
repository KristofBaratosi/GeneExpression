#DATA NORMALIZATION
library(tidyverse)
library(dplyr)
sample_info <-  read.csv("/Users/baratosikristof/Desktop/Main/bioinfo/chrons_raw_files/sample_information.csv",row.names = 1)
counts_matrix <-  read.csv("/Users/baratosikristof/Desktop/Main/bioinfo/chrons_raw_files/counts_matrix.csv",row.names = 1)
sample_info[c('sex', 'condition', 'outcome')] <- lapply(sample_info[c('sex', 'condition', 'outcome')], factor)
library(DESeq2)
colData <-  read.csv("/Users/baratosikristof/Desktop/Main/bioinfo/chrons_raw_files/sample_information.csv",row.names = 1)
counts_data <-  read.csv("/Users/baratosikristof/Desktop/Main/bioinfo/chrons_raw_files/counts_matrix.csv",row.names = 1)
colData[c('sex', 'condition', 'outcome')] <- lapply(colData[c('sex', 'condition', 'outcome')], factor)
View(colData)
View(counts_data)
all(colnames(counts_data) %in% rownames(colData))
all(colnames(counts_data) ==rownames(colData))
#Deseq dataset object
dds <- DESeqDataSetFromMatrix(countData = counts_data, colData = colData, design = ~outcome)
dds
#pre-filtering rows that have at least 10 reads total
keep <- rowSums(counts(dds))>=10
keep
dds <- dds[keep,]
dim(dds)
View(counts_data)
View(dds)
View(counts_data)
View(dds)
dds$outcome<- relevel(dds$dexamethasone,ref="0")
dds <- DESeq(dds)
#exploring results
res <- results(dds)
res
#summary of res
summary(res)
summary(res)
res.001= results(dds, alpha = 0.01)
res.001
summary(res.001)
summary(res)
res.001= results(dds, alpha = 0.001)
res.001
summary(res.001)
df <- counts(dds, normalized=T)
head(df)
#PCA
pca <- prcomp(t(df),scale. = TRUE)
pca
plot(pca$x[,1],pca$x[,2])
pca.data <- data.frame(Sample=rownames(pca$x),
X=pca$x[,1],
Y=pca$x[,2])
ggplot(data = pca.data, aes(x = X, y = Y, color = colData$outcome)) +
geom_point() +
xlab(paste("PC1 - ", pca.var.per[1], "%", sep = "")) +
ylab(paste("PC2 - ", pca.var.per[2], "%", sep = "")) +
theme_bw() +
ggtitle("PCA Plot",subtitle = "PCA1(x-axis) and PCA2(y-axis)")+
theme(plot.title = element_text(hjust = 0.5))+
theme(plot.subtitle = element_text(hjust = 0.5))+
labs(color = "Treatment")
pca.var <- pca$sdev^2
pca.var.per <- round(pca.var/sum(pca.var)*100, 1)
ggplot(data = pca.data, aes(x = X, y = Y, color = colData$outcome)) +
geom_point() +
xlab(paste("PC1 - ", pca.var.per[1], "%", sep = "")) +
ylab(paste("PC2 - ", pca.var.per[2], "%", sep = "")) +
theme_bw() +
ggtitle("PCA Plot",subtitle = "PCA1(x-axis) and PCA2(y-axis)")+
theme(plot.title = element_text(hjust = 0.5))+
theme(plot.subtitle = element_text(hjust = 0.5))+
labs(color = "Treatment")
library(tidyverse)
library(dplyr)
raw_counts <- read.table(file="/Users/baratosikristof/Desktop/Main/bioinfo/chrons_raw_files/ArrayExpress-raw.csv",
sep=",",
header=T,
fill=T,
check.names=F)
dim(raw_counts)
sample_info <- read.table(file="/Users/baratosikristof/Desktop/Main/bioinfo/chrons_raw_files/E-MTAB-11349.sdrf.txt", sep="\t", header=T, fill=T, check.names=F)
dim(sample_info)
View(raw_counts)
glimpse(sample_info)
ibd.samp.names <- colnames(raw_counts)[3:ncol(raw_counts)]
lst.colnames
lst.colnames <- c()
for(i in seq_along(1:ncol(sample_info))){
lst.colnames[i] <- all(sample_info[,i] == ibd.samp.names)
}
lst.colnames
sample_info_selected <- rename(sample_info_selected,
'sampleID' = 'Source Name',
'age' = 'Characteristics[age]',
'sex' = 'Characteristics[sex]',
'condition' = 'Characteristics[disease]'
)
sample_info_selected <- select(sample_info,
'Source Name',
'Characteristics[age]',
'Characteristics[sex]',
'Characteristics[disease]'
)
sample_info_selected <- rename(sample_info_selected,
'sampleID' = 'Source Name',
'age' = 'Characteristics[age]',
'sex' = 'Characteristics[sex]',
'condition' = 'Characteristics[disease]'
)
View(sample_info_selected)
sample_info_selected$condition[agrep("Crohns", sample_info_selected$condition)] <- "crohns_disease"
sample_info_selected <- sample_info_selected %>%
mutate(outcome = if_else(condition == 'normal', 0, 1))
sample_info_selected <- sample_info_selected %>%
mutate(sampleID = gsub(" ", "_", sampleID),
condition = gsub(" ", "_", condition))
sample_info_selected[c('sex', 'condition', 'outcome')] <- lapply(sample_info_selected[c('sex', 'condition', 'outcome')], factor)
glimpse(sample_info_selected)
counts_matrix <- raw_counts[-1,-1]
rownames(counts_matrix) <- NULL
counts_matrix <-  counts_matrix %>% column_to_rownames('read')
colnames(counts_matrix) <- gsub(" ", "_", colnames(counts_matrix))
#all(sample_info_selected$sampleID==colnames(counts_matrix))
View(counts_matrix)
library(tidyverse)
library(dplyr)
library(caret)
library(pROC)
library(pROC)
library(e1071)
library(randomForest)
library(DESeq2)
library(preprocessCore)
#reading in the raw counts and the sample information files
colData <-  read.csv("/Users/baratosikristof/Desktop/Main/bioinfo/chrons_raw_files/sample_information.csv",row.names = 1)
counts_data <-  read.csv("/Users/baratosikristof/Desktop/Main/bioinfo/chrons_raw_files/counts_matrix.csv",row.names = 1)
#converting the condition and outcome columns to factors
colData[c( 'condition', 'outcome')] <- lapply(colData[c( 'condition', 'outcome')], factor)
#checking whether the order of the samples in colData is identical to counts_data
all(colnames(counts_data) %in% colData$sampleID)
all(colnames(counts_data) ==colData$sampleID)
#Deseq dataset object
dds <- DESeqDataSetFromMatrix(countData = counts_data, colData = colData, design = ~condition)
#Removing genes that don't have at least 75 reads total
keep <- rowSums(counts(dds))>=75
dds <- dds[keep,]
dim(dds)
# Extracting normalized counts
dds <- estimateSizeFactors(dds)
df <- counts(dds, normalized = TRUE)
#quantile normalization
df_norm <- normalize.quantiles(df)
#restoring row and column names
rownames(df_norm) <- rownames(df)
colnames(df_norm) <- colnames(df)
#Transposing the df so we have the samples as rows, and genes as columns
ml_df <-  as.data.frame(t(df_norm))
dim(ml_df)
#assigning the target variable to the dataframe
ml_df$outcome <- colData$outcome
dim(ml_df)
#MACHINE LEARNING
#setting seed for reproducibility
set.seed(5)
#Creating training and test sets- train: 80%, test: 20%
split_index <- sample(1:nrow(ml_df), 0.8 * nrow(ml_df))
train_data <- ml_df[split_index, ]
test_data <- ml_df[-split_index, ]
train_features <- train_data[, -ncol(train_data)]
train_target <- train_data[, ncol(train_data)]
test_features <- test_data[, -ncol(test_data)]
test_target <- test_data[, ncol(test_data)]
#PCA on train features, transforming  test_features to PC's
#(Using first 35 PC's for the models)
pca <- prcomp(train_features,scale. = TRUE)
train_features <- as.data.frame(pca$x[,1:35])
test_features <- predict(pca, newdata = test_features)
test_features <- test_features[,1:35]
test_features <- as.data.frame(test_features)
dim(train_features)
dim(test_features)
#Creating dataframe to plot the first and second principal components
pca.data <- data.frame(Sample=rownames(pca$x),
X=pca$x[,1],
Y=pca$x[,2])
#Extracting the amount of variation explained by PC's
pca.var <- pca$sdev^2
pca.var.per <- round(pca.var/sum(pca.var)*100, 1)
#Scree plot
barplot(pca.var.per[1:15], main="Scree Plot", xlab="Principal Component", ylab="Percent Variation")
#Plotting PC1 and PC2
ggplot(data = pca.data, aes(x = X, y = Y, color = train_target)) +
geom_point() +
xlab(paste("PC1 - ", pca.var.per[1], "%", sep = "")) +
ylab(paste("PC2 - ", pca.var.per[2], "%", sep = "")) +
theme_bw() +
ggtitle("PCA Plot")+
theme(plot.title = element_text(hjust = 0.5))+
labs(color = "Disease")
# RANDOM FOREST CLASSIFIER
rf_model <- randomForest(train_features, train_target, ntree = 100)
predictions <- predict(rf_model, test_features)
prediction_probs <- predict(rf_model, test_features,type = "prob")
rfc_accuracy <- sum(predictions == test_target) / length(test_target)
print(paste("Accuracy of Random Forest Classifier on  the test set:", round(rfc_accuracy * 100, 2), "%"))
#LOGISTIC REGRESSION
logit_model <- glm(train_target ~ ., data = train_features, family = "binomial")
test_predictions <- predict(logit_model, newdata = test_features, type = "response")
test_binary_predictions <- ifelse(test_predictions > 0.5, 1, 0)
logreg_accuracy <- sum(test_binary_predictions == test_target) / length(test_target)
print(paste("Accuracy of Logistic Regression on the test set:", round(logreg_accuracy * 100, 2), "%"))
#NAIVE BAYES
nb_model <- naiveBayes(train_features, train_target)
nb_predictions <- predict(nb_model, test_features)
nb_accuracy <- sum(nb_predictions == test_target) / length(test_target)
cat("Accuracy of Naive Bayes on the test set:", nb_accuracy, "\n")
#Support Vector Machine
svm_model <- svm(train_target ~ ., data = train_features)
svm_predictions <- predict(svm_model, newdata = test_features)
svm_accuracy <- sum(svm_predictions == test_target) / length(test_target)
cat("Accuracy of SVM on the test set:", svm_accuracy, "\n")
svm_model <- svm(train_target ~ ., data = train_features, probability = TRUE)
svm_probabilities <- predict(svm_model, newdata = test_features, probability = TRUE)
# Extracting probabilities for the positive class
svm_positive_probs <- attr(svm_probabilities, "probabilities")[, "1"]
# Creating a data frame that contains the accuracy of the models
accuracy_df <- data.frame(model = c("Random Forest Classifier", "Logistic Regression","Naive Bayes","Support Vector Machine"),
accuracy = c(rfc_accuracy,logreg_accuracy,nb_accuracy,svm_accuracy) )
#Creating a bar plot for model accuracy
ggplot(accuracy_df, aes(x = reorder(model,-accuracy), y = accuracy, fill = model)) +
geom_bar(stat = "identity", color = "black",width = 0.4) +
labs(title = "Accuracy of the Models", x = "Model", y = "Accuracy") +
ylim(0, 1)+
theme_minimal()
#ROC PLOT
#This prevents the axes from going beyond 1
par(pty="s")
#Calculating roc and auc for logistic regression, random forest classifier and support vector machine
roc(test_target, test_predictions,plot= TRUE, legacy.axes = TRUE,
col= "#377eb8",lwd=4,print.auc=TRUE, percent=TRUE,xlab="False Positive Percentage", ylab="True Postive Percentage")
plot.roc(test_target,prediction_probs[,2],col="#4daf4a", lwd=4, percent=TRUE,print.auc=TRUE, add=TRUE, print.auc.y=42)
plot.roc(test_target,svm_positive_probs,col="#de2d26", lwd=4, percent=TRUE,print.auc=TRUE, add=TRUE, print.auc.y=35)
#Creating legend
legend("bottomright", legend=c("Logisitic Regression", "Random Forest", "Support Vector Machine"), col=c("#377eb8", "#4daf4a","#de2d26"), lwd=3,cex = 0.7)
#Setting  graphics back to normal
par(pty = "m")
#Creating confusion  matrices
svm_cm <- confusionMatrix(svm_predictions,test_target)
rfc_cm <- confusionMatrix(predictions,test_target)
logreg_cm <- confusionMatrix(as.factor(test_binary_predictions),test_target)
nb_cm <- confusionMatrix(nb_predictions,test_target)
#Viewing the matrices
svm_cm
rfc_cm
logreg_cm
nb_cm
View(accuracy_df)
View(colData)
View(counts_data)
View(ml_df)
View(pca)
View(test_features)
View(train_features)
#DATA PREPERATION
#Reading in the files
library(tidyverse)
library(dplyr)
raw_counts <- read.table(file="ArrayExpress-raw.csv",
sep=",",
header=T,
fill=T,
check.names=F)
dim(raw_counts)
sample_info <- read.table(file="E-MTAB-11349.sdrf.txt", sep="\t", header=T, fill=T, check.names=F)
dim(sample_info)
glimpse(sample_info)
#Selecting important columns
sample_info_selected <- select(sample_info,
'Source Name',
'Characteristics[age]',
'Characteristics[sex]',
'Characteristics[disease]'
)
sample_info_selected <- rename(sample_info_selected,
'sampleID' = 'Source Name',
'age' = 'Characteristics[age]',
'sex' = 'Characteristics[sex]',
'condition' = 'Characteristics[disease]'
)
#Renaming patients with chrons disease
sample_info_selected$condition[agrep("Crohns", sample_info_selected$condition)] <- "crohns_disease"
#encoding "normal" patients with 0 and every other patient with 1
sample_info_selected <- sample_info_selected %>%
mutate(outcome = if_else(condition == 'normal', 0, 1))
#Changing spaces to _
sample_info_selected <- sample_info_selected %>%
mutate(sampleID = gsub(" ", "_", sampleID),
condition = gsub(" ", "_", condition))
sample_info_selected[c('sex', 'condition', 'outcome')] <- lapply(sample_info_selected[c('sex', 'condition', 'outcome')], factor)
glimpse(sample_info_selected)
#Cleaning up the counts matrix
counts_matrix <- raw_counts[-1,-1]
rownames(counts_matrix) <- NULL
counts_matrix <-  counts_matrix %>% column_to_rownames('read')
colnames(counts_matrix) <- gsub(" ", "_", colnames(counts_matrix))
#all(sample_info_selected$sampleID==colnames(counts_matrix))
#Saving them as csv files
write.csv(counts_matrix, file="/Users/baratosikristof/Desktop/Main/bioinfo/chrons_raw_files/counts_matrix.csv")
write.csv(sample_info_selected, file="/Users/baratosikristof/Desktop/Main/bioinfo/chrons_raw_files/sample_information.csv")
View(counts_matrix)
View(sample_info_selected)
